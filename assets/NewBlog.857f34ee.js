import{h as I,f as L,g as v,x as r,t as _,j as B,k as p,v as T,u as g,o as D,c as k,i as y,a,z as P,b as S,H as V,I as N,J as A,K as j,A as $,L as F,N as O}from"./vendor.50372c04.js";import{s as M,l as C,b as z,a as K,_ as U,c as H,d as J,e as R,f as W}from"./index.a3232022.js";const q=I({setup(f,{expose:s}){const e=L({title:"",content:"",resources:[],saveable:!1,textMutated:0,modified:new Date}),d=v(!1),n=v(null);x();async function x(){let t;try{t=M.blogEditData}catch{M.blogEditData=void 0}if(console.log("oldData",t),!!t){if(t.title!==""){const o=await C(t.title);if(o&&(console.log(o.modified,t.modified),o.modified>t.modified)){Object.assign(e,o),console.log("rejected",o);return}}Object.assign(e,t),console.log("accepted",t)}}async function b(t){var i;if(t===e.title)return;const o=e.saveable;e.saveable=!1;try{let c;c=(i=await C(t))!=null?i:{title:"",content:"",resources:[],modified:new Date},await m(c.content),e.title=t,e.saveable=!0,u()}catch(c){console.error("Something went wrong when loading the post:",c),e.saveable=o}}async function m(t){if(console.log(e.textMutated),e.textMutated!==0&&confirm("Save unsaved changes?")&&!await h())throw new Error("Save Failure");w(t,0,n.value.value.length),e.textMutated=0}async function h(){console.log("saving...");try{const t=e.textMutated,o=await z(K(e.title,e.content),d);return console.log("saved."),e.textMutated-=t,e.modified=new Date,!0}catch(t){return console.log("save failed."),console.log(t),!1}}function w(t,o=null,i=null){n.value.focus(),console.log(n.value.focus),o!==null&&(n.value.selectionStart=o),i!==null&&(n.value.selectionEnd=i),document.execCommand("insertText",!1,t),u()}const l={changePost:b,save:h,isSaving:r(d),saveable:r(_(e,"saveable")),textMutated:r(_(e,"textMutated")),title:r(_(e,"title")),content:r(_(e,"content")),resources:r(_(e,"resources"))};function u(){M.blogEditData=e}return s(l),B(()=>n.value.addEventListener("keydown",function(t){e.saveable&&(e.textMutated+=1);let o;if(t.key==="Tab")t.preventDefault(),o="  ";else if(t.key==="Enter"){t.preventDefault();const i=this.value.lastIndexOf(`
`,this.selectionStart-1);let c=this.value.slice(i+1,this.selectionStart).search(/[^ ]/);c===-1&&(c=this.selectionStart-i-1),o=`
`+" ".repeat(c)}else return;w(o)})),(t,o)=>p((D(),k("textarea",{id:"edit-area",class:"flex-child-fill",ref_key:"editArea",ref:n,"onUpdate:modelValue":o[0]||(o[0]=i=>g(e).content=i),onKeydown:u},`
        
    `,544)),[[T,g(e).content]])}});const E=f=>(F("data-v-b320e12e"),f=f(),O(),f),G={class:"content-column no-basis"},Q={class:"content-row flex-wrap tight"},X={class:"content-column tight"},Y=E(()=>a("label",{for:"toggle-autosave"},"Autosave",-1)),Z={class:"content-row"},ee={class:"content-column no-basis"},te={class:"content-bar"},ae=E(()=>a("label",{for:"markdown-input"},"Post Text",-1)),oe=[ae],se={key:0},ne=["value","disabled"],le={class:"content-column no-basis"},ie={class:"content-bar"},ue=E(()=>a("h2",null," Post Preview ",-1)),ce=["value"],de=I({setup(f){const s=v({content:"",title:""}),e=v(!0),d=v(!1),n=v(!1),x=y(()=>e.value?"Show Full Preview":"Show Editor"),b=y(()=>s.value.textMutated?s.value.textMutated+" unsaved characters":"No title selected; changes will not be saved."),m=y(()=>!R.value&&W.authenticated);function h(){d.value&&s.value.textMutated&&s.value.save()}return setInterval(()=>h(),2e4),(w,l)=>(D(),k("form",{style:{display:"flex"},onSubmit:l[3]||(l[3]=$(()=>{},["prevent"]))},[a("div",G,[a("div",Q,[a("div",null,[a("h2",null,' Editing "'+P(s.value.title)+'" ',1)]),a("h2",null,[S(H,{disabled:n.value,"on-submit":s.value.changePost,"button-text":n.value?"Loading...":"Load","not-exists-text":"New"},null,8,["disabled","on-submit","button-text"])]),a("div",X,[a("div",null,[p(a("input",{"onUpdate:modelValue":l[0]||(l[0]=u=>d.value=u),type:"checkbox",name:"toggle-autosave"},null,512),[[V,d.value]]),Y])])]),a("div",Z,[p(a("div",ee,[a("div",te,[a("h2",{style:A("font-style: "+(s.value.textMutated===0?"normal":"italic"))},oe,4),p(a("p",{style:{"flex-grow":"1"}},P(g(b)),513),[[N,s.value.textMutated>0]]),g(m)?(D(),k("span",se,[a("input",{type:"submit",value:s.value.isSaving?"Saving...":"Save",disabled:s.value.isSaving||!s.value.saveable,onClick:l[1]||(l[1]=(...u)=>s.value.save&&s.value.save(...u))},null,8,ne)])):j("",!0)]),S(q,{ref_key:"editor",ref:s},null,512)],512),[[N,e.value]]),a("div",le,[a("div",ie,[ue,a("span",null,[a("input",{type:"submit",value:g(x),onClick:l[2]||(l[2]=u=>e.value=!e.value)},null,8,ce)])]),S(J,{title:s.value.title,"external-text":s.value.content},null,8,["title","external-text"])])])])],32))}});var fe=U(de,[["__scopeId","data-v-b320e12e"]]);export{fe as default};
